document.addEventListener('DOMContentLoaded', () => {
  const form = document.getElementById('announcementForm');
  const list = document.getElementById('announcementList');
  const modal = document.getElementById('modal');
  const modalBody = document.getElementById('modalBody');
  const closeBtn = document.querySelector('.close');

  // Elanları localStorage-dan yüklə
  const saved = localStorage.getItem('elanlar');
  if (saved) list.innerHTML = saved;

  // Modal bağlama funksiyası
  closeBtn.onclick = () => modal.style.display = 'none';
  window.onclick = e => {
    if (e.target == modal) modal.style.display = 'none';
  };

  // Ətraflı bax düyməsi üçün dinləyici
  list.addEventListener('click', e => {
    if (e.target.classList.contains('details-btn')) {
      const card = e.target.closest('.announcement');
      modalBody.innerHTML = card.innerHTML;
      modal.style.display = 'block';
    }
  });

  // Elan əlavə et
  form.addEventListener('submit', e => {
    e.preventDefault();

    const title = form.title.value.trim();
    const content = form.content.value.trim();
    const price = form.price.value.trim();
    const category = form.category.value.trim();
    const imageInput = form.image;
    const file = imageInput.files[0];
    const id = 'ELN' + Date.now();
    const date = new Date().toLocaleString();

    const reader = new FileReader();
    reader.onload = function () {
      const imgSrc = file ? reader.result : '';
      const div = document.createElement('div');
      div.className = 'announcement';
      div.setAttribute('data-category', category);
      div.setAttribute('data-title', title.toLowerCase());

      div.innerHTML = `
        ${imgSrc ? `<img src='${imgSrc}' alt='Elan şəkli' />` : ''}
        <div class='announcement-content'>
          <h3>${title}</h3>
          <p class='price'>${price} AZN</p>
          <p class='category'>Kateqoriya: ${category}</p>
          <p>${content}</p>
          <small>Tarix: ${date} | ID: ${id}</small><br>
          <button class='details-btn'>Ətraflı bax</button>
        </div>
      `;

      list.prepend(div);
      localStorage.setItem('elanlar', list.innerHTML);
      form.reset();
    };

    if (file) reader.readAsDataURL(file);
    else reader.onload();
  });

  // Filtrləmə
  const filterCategory = document.getElementById('filterCategory');
  const searchInput = document.getElementById('searchInput');

  function applyFilters() {
    const selected = filterCategory.value;
    const search = searchInput.value.toLowerCase();

    document.querySelectorAll('.announcement').forEach(elan => {
      const matchesCategory = (selected === 'Hamısı' || elan.dataset.category === selected);
      const matchesSearch = elan.dataset.title.includes(search);
      elan.style.display = (matchesCategory && matchesSearch) ? 'flex' : 'none';
    });
  }

  filterCategory.addEventListener('change', applyFilters);
  searchInput.addEventListener('input', applyFilters);
});
